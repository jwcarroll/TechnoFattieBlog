---
layout: post
title: MandelBrot Bitmap
---

So recently I was reading <a href="http://www.secretgeek.net">secretGeek</a> (a very underated blog I enjoy), and there was this interesting post about an <a href="http://blogs.msdn.com/lukeh/archive/2007/11/14/f.aspx">F# program</a> that Mr. Bambrick tweaked a little. The <a href="http://www.secretgeek.net/f_mandel.asp">variation</a> was interesting, and it piqued my interests into the cryptic style behind F#. However, just before I could get away with another quick read my geekish manhood was challenged.<br /><blockquote><br /><p align="left"><em>"Your mission!<br />Next step: do the same thing rendering pixels to a bitmap instead... then i could try breaking that up amongst multiple cores... no... sleep time.<br /><br />The interested reader is invited to finish this problem for me ;-)"</em><br /></p><br /><p>-- secretGeek</p></blockquote><br /><br /><p>I had to do something or I could never again return to secretGeek without being pushed around by all the other readers (they think they're so cool with their big brains). So... I went home and geeked out in front of my laptop, which is kind of like Hulking out for nerds except for the muscles and awesomeness.</p><br /><p>After installing the F# components and firing up VS, I copied the necessary file and began to make some modifications. After 3 hours of staring at documentation (Oh what I wouldn't give for some curly braces) and about 30 seconds of coding I came up with a pretty simple solution that works nicely.</p><br /><p>Here are the relevant code changes:</p><br /><br /><blockquote><code><span style="font-family:courier new;"><span style="color:#3333ff;">let</span> stepY = 0.1 / 40.0 </span><span style="font-family:courier new;"><span style="color:#009900;">//Scale goes in increments of 20 pixels for height<br /></span><span style="color:#3333ff;">let</span> stepX = 0.05 / 20.0 </span><span style="font-family:courier new;"><span style="color:#006600;"><span style="color:#009900;">//Scale goes in increments of 60 pixels for width</span><br /></span><br /><span style="color:#009900;">//Simple declarations to get the height and width of the Bitmap</span><br /><span style="color:#3333ff;">let</span> numPixelsX = (int)(3.0 / stepX)<br /><span style="color:#3333ff;">let</span> numPixelsY = (int)(2.0 / stepY)<br /><span style="color:#3333ff;">let</span> bmp = <span style="color:#3333ff;">new</span> Bitmap(numPixelsX, numPixelsY)<br /><br /></span><span style="font-family:courier new;"><span style="color:#009900;">//This is used to figure out what the current X and Y coordinates are<br />// during processing in order to set the appropriate pixels in the Bitmap</span><br /><span style="color:#3333ff;">let</span> getPosY y = (int)(Math.Abs((Math.Floor -1.0 - y) / stepY))<br /><span style="color:#3333ff;">let</span> getPosX x = (int)(Math.Abs((Math.Floor -2.0 - x) / stepX))<br /><br /><span style="color:#3333ff;">for</span> y <span style="color:#3333ff;">in</span> [-1.0..stepY..1.0] <span style="color:#3333ff;">do</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3333ff;">for</span> x <span style="color:#3333ff;">in</span> [-2.0..stepX..1.0] <span style="color:#3333ff;">do </span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3333ff;">match</span> mandelbrot (Complex.Create (x, y)) <span style="color:#3333ff;">with</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;DidNotEscape -> bmp.SetPixel(getPosX x, getPosY y, Color.FromArgb(255, 255, 255));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Escaped e -> bmp.SetPixel(getPosX x, getPosY y, Color.FromArgb((min 9 e) * 20, 0, 0));<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3333ff;">done</span>;<br /><span style="color:#3333ff;">done</span>;<br /><br />bmp.Save(String.Format(<span style="color:#990000;">"Images\\mandelBrot_{0}_{1}.bmp"</span>, numPixelsX, numPixelsY), ImageFormat.Bmp)<br />bmp.Save(String.Format(<span style="color:#990000;">"Images\\mandelBrot_{0}_{1}.png"</span>, numPixelsX, numPixelsY), ImageFormat.Png)<br />bmp.Save(String.Format(<span style="color:#990000;">"Images\\mandelBrot_{0}_{1}.jpeg"</span>, numPixelsX, numPixelsY), ImageFormat.Jpeg)</span></code></blockquote><br /><br /><p>And here is a sample of what the output looks like:</p><br /><p><a href="http://2.bp.blogspot.com/_zrLYGpcNAqw/R2y6BEgHIgI/AAAAAAAAADc/ak_RH1D9FFE/s1600-h/mandelBrot_300_200.jpeg"><img id="BLOGGER_PHOTO_ID_5146693001728696834" style="DISPLAY: block; MARGIN: 0px auto 10px; CURSOR: hand; TEXT-ALIGN: center" alt="" src="http://2.bp.blogspot.com/_zrLYGpcNAqw/R2y6BEgHIgI/AAAAAAAAADc/ak_RH1D9FFE/s320/mandelBrot_300_200.jpeg" border="0" /></a></p><br /><p>Cheers,</p><p>Josh<br /></p>
