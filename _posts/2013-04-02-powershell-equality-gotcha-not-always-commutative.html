---
layout: post
title: ! 'PowerShell Equality Gotcha: Not Always Commutative'
---

PowerShell is awesome! However, it also has its share of maddening quirks.<br /><br />Jim Christopher (<a href="https://twitter.com/beefarino">@beefarino</a>) has highlighted one such quirk in the form of <a href="http://beefycode.com/post/PowerShell-Mini-game-Equality.aspx">a brain teaser on his blog</a>. The question is deceptively simple, but unless you have done a dance or three with PowerShell it might leave you scratching your head.<br /><br /><blockquote class="tr_bq">Query: In PowerShell, when is the following statement true? Explain why.</blockquote><blockquote class="tr_bq">&nbsp; &nbsp; &nbsp;( $a -eq $b ) -ne ( $b -eq $a )</blockquote><br />Know the answer? Try assigning these values to $a and $b<br /><br /><pre><br /><code><br />$a = 1<br />$b = '01'<br /></code><br /></pre><br />If you run that expression again, it should come up as true.<br /><br />Why?<br /><br />It all has to do with what PowerShell is doing automatically for you. Since a string and an integer are disparate types, <b>PowerShell is attempting to cast the values to the same type in order to do a comparison</b>. In order to determine which type to cast to, the left operand is used.<br /><br />If we write our expression out the way it is being&nbsp;interpreted, then it becomes pretty obvious what is going on.<br /><br /><pre><br /><code><br />([int]1 -eq [int]'01') -ne ([string]'01' -eq [string]1)<br /></code><br /></pre><br />See what's going on? Obviously casting '01' to an [int] is not the same as casting 1 to a [string].<br /><br />This is one of those things that makes sense when you look at it directly, but when it is an obscure bug&nbsp;buried&nbsp;deep inside one of your production scripts... it can drive you insane.<br /><br />Just remember that equality&nbsp;comparisons&nbsp;in PowerShell are not always commutative.<br /><br />Happy Scripting, and thanks&nbsp;<a href="https://twitter.com/beefarino">@beefarino</a> for a fun challenge, and being the guy who made me want to learn PowerShell in the first place :)
