---
layout: post
title: Solving Ayende's Tax Woes
tags: [c#,dot-net,tdd,unit-testing]
alias: /2011/09/solving-ayendes-tax-woes.html
---

<a href="http://ayende.com/blog/">Oren Eini</a>&nbsp;(a.k.a. Ayende Rahien)&nbsp;is going through the joy that is <a href="http://ayende.com/blog/102403/pet-projects-and-hiring-decisions">trying to find good developers</a>. The other day he posted some sample code that an interviewee had turned in to a coding challenge. The <a href="http://ayende.com/blog/102401/negative-hiring-decisions-part-i">results</a> weren't pretty!<br /><br /><b>The problem involves calculating a persons taxes based on a set of tax brackets.&nbsp;</b><br /><br />It makes a great interview question because the problem is short enough to get done in an hour or so, but tricky enough to require some thought. Here are the specs as <a href="http://ayende.com/blog/108545/the-tax-calculation-challenge">posted by Ayende</a>:<br /><br /><blockquote><b><u>Israel's Tax Brackets:</u></b><br /><span class="Apple-style-span" style="background-color: white; color: #333333; font-family: georgia, verdana, arial, sans-serif; font-size: 16px; line-height: 16px;"></span><br /><table border="0" cellpadding="2" cellspacing="0" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; border-bottom-width: 0px; border-collapse: collapse; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline; width: 400px;"><tbody style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200"></td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">Tax Rate</td></tr><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">Up to 5,070</td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">10%</td></tr><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">5,071 up to 8,660</td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">14%</td></tr><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">8,661 up to 14,070</td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">23%</td></tr><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">14,071 up to 21,240</td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">30%</td></tr><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">21,241 up to 40,230</td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">33%</td></tr><tr style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">Higher than 40,230</td><td style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 0.9em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;" valign="top" width="200">45%</td></tr></tbody></table></blockquote><blockquote><table border="0" cellpadding="2" cellspacing="0" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; border-bottom-width: 0px; border-collapse: collapse; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline; width: 400px;"><tbody style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"></tbody></table><span class="Apple-style-span" style="background-color: white; color: #333333; font-family: georgia, verdana, arial, sans-serif; font-size: 16px; line-height: 16px;"></span><br /><b><u>Acceptance Tests:</u></b>&nbsp;</blockquote><blockquote><ul style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 40px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><li style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;">5,000 –&gt; 500</li></ul><ul style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 40px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><li style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;">5,800 –&gt; 609.2</li></ul><ul style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 40px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><li style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;">9,000 –&gt; 1087.8</li></ul><ul style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 40px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><li style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;">15,000 –&gt; 2532.9</li></ul><ul style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; list-style-type: disc; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 40px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"><li style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-size: 16px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;">50,000 –&gt; 15,068.1</li></ul></blockquote>Having not yet read the other comments or solutions, I thought it would be fun to take a crack at writing my own solution to the problem.<br /><br />I am a huge proponent of unit testing, and more specifically <b>T</b>est <b>D</b>riven <b>D</b>evelopment. Since we have a nice set of acceptance tests, it is pretty easy to get those into code.<br /><br />I started with the simplest of tests I could think of.<br /><br /><pre class="c-sharp" name="code">[TestMethod]<br />public void ShouldCalculateTotalTaxesToBeZero() {<br />   var effectiveTax = new EffectiveTax();<br /><br />   var result = effectiveTax.CalculateTaxes(0);<br /><br />   Assert.AreEqual(0, result);<br />}<br /></pre><br />Which led me to create this simple implementation.<br /><br /><pre class="c-sharp" name="code">public class EffectiveTax <br />{      <br />   public Decimal CalculateTaxes(Decimal grossIncome) <br />   {<br />      return 0;<br />   }<br />}<br /></pre><br />Alright, so not very useful. But the tests pass!<br /><br />Now we need to be able to expand on this a bit and add a tax bracket in the mix.&nbsp;A tax bracket has some lower-bound, and a rate.&nbsp;We can write another pretty simple test for that.<br /><br /><pre class="c-sharp" name="code">[TestMethod]<br />public void ShouldCalculateTaxesUsingSingleTaxBracket() {<br />   var effectiveTax = new EffectiveTax();<br />   effectiveTax.AddTaxBracket(lowerBound: 0, taxRate: 0.1M);<br /><br />   Assert.AreEqual(0, effectiveTax.CalculateTaxes(0));<br />   Assert.AreEqual(100, effectiveTax.CalculateTaxes(1000));<br />   Assert.AreEqual(1000, effectiveTax.CalculateTaxes(10000));<br />}<br /></pre><br /><i>(Note: The use of named parameters is to aid in the design process. Since I wrote the code before the method existed, the IDE can infer the parameter names and automatically generate a signature for me. Also, it helps to clarify what is going on in the test.)</i><br /><br />We Add just enough code to get the tests passing, which is certainly more useful than the previous iteration, but far from complete. Some might object to my introducing a <b>TaxBracket</b> type into the mix so early, but writing just enough code doesn't preclude one from writing clean code. The extra type helps to tidy things up, and makes future refactoring work easier with little extra work.<br /><br /><pre class="c-sharp" name="code">public class EffectiveTax {<br /><br />   private TaxBracket _taxBracket;<br /><br />   public Decimal CalculateTaxes(Decimal grossIncome) {<br />      return grossIncome * _taxBracket.TaxRate;<br />   }<br /><br />   public void AddTaxBracket(Decimal lowerBound, Decimal taxRate) {<br />      _taxBracket = new TaxBracket {<br />         LowerBound = lowerBound,<br />         TaxRate = taxRate<br />      };<br />   }<br /><br />   private class TaxBracket {<br />      internal Decimal LowerBound { get; set; }<br />      internal Decimal TaxRate { get; set; }<br />   }<br />}<br /></pre><br />This rev is also incomplete since it doesn't take the lower-bound into account. So... we write another test case to cover that scenario.<br /><br /><pre class="c-sharp" name="code">[TestMethod]<br />public void ShouldCalculateOnlyTaxableIncome() {<br />   var effectiveTax = new EffectiveTax();<br />   effectiveTax.AddTaxBracket(lowerBound: 5000, taxRate: 0.1M);<br /><br />   Assert.AreEqual(0, effectiveTax.CalculateTaxes(0));<br />   Assert.AreEqual(0, effectiveTax.CalculateTaxes(4999));<br />   Assert.AreEqual(0, effectiveTax.CalculateTaxes(5000));<br />   Assert.AreEqual(10, effectiveTax.CalculateTaxes(5100));<br />}<br /></pre><br />A minor change to the code, and now we can effectively handle a single flat tax, with an optional poverty line.<br /><br /><pre class="c-sharp" name="code">public Decimal CalculateTaxes(Decimal grossIncome) {<br />   var effectiveTax = 0.0M;<br />         <br />   if (grossIncome > _taxBracket.LowerBound) {<br />      var taxableIncome = grossIncome - _taxBracket.LowerBound;<br />            <br />      effectiveTax = taxableIncome * _taxBracket.TaxRate;<br />   }<br /><br />   return effectiveTax;<br />}<br /></pre><br />However, what we want is a system with multiple tax brackets. Now we get to the testing scenario that was previously laid out for us. We can easily translate those tables into a test.<br /><br /><pre class="c-sharp" name="code">[TestMethod]<br />public void ShouldCalculateTaxUsingIsraelsTaxBrackets() {<br />   var effectiveTax = new EffectiveTax();<br />   effectiveTax.AddTaxBracket(lowerBound: 0, taxRate: 0.1M);<br />   effectiveTax.AddTaxBracket(lowerBound: 5070, taxRate: 0.14M);<br />   effectiveTax.AddTaxBracket(lowerBound: 8660, taxRate: 0.23M);<br />   effectiveTax.AddTaxBracket(lowerBound: 14070, taxRate: 0.30M);<br />   effectiveTax.AddTaxBracket(lowerBound: 21240, taxRate: 0.33M);<br />   effectiveTax.AddTaxBracket(lowerBound: 40230, taxRate: 0.45M);<br /><br />   Assert.AreEqual(0, effectiveTax.CalculateTaxes(0));<br />   Assert.AreEqual(500, effectiveTax.CalculateTaxes(5000));<br />   Assert.AreEqual(609.2M, effectiveTax.CalculateTaxes(5800));<br />   Assert.AreEqual(1087.8M, effectiveTax.CalculateTaxes(9000));<br />   Assert.AreEqual(2532.9M, effectiveTax.CalculateTaxes(15000));<br />   Assert.AreEqual(15068.1M, effectiveTax.CalculateTaxes(50000));<br />}<br /></pre><br />It was obvious that we needed some sort of collection to hold the TaxBrackets, and that we would need to loop over them to calculate the effective tax. The decision to reverse the loop, greatly simplifies the processing.<br /><br />Essentially we start with the highest amount of money that has a tax rate, and chop off that amount from the total amount remaining, taxing each chunk as we go and adding it to the total.<br /><br /><pre class="c-sharp" name="code">public class EffectiveTax {<br /><br />   private readonly List<taxbracket> _taxBrackets = new List<taxbracket>();<br /><br />   public Decimal CalculateTaxes(Decimal grossIncome) {<br />      var effectiveTax = 0.0M;<br />      var incomeLeftToTax = grossIncome;<br /><br />      for (var i = (_taxBrackets.Count - 1); i >= 0; i--) {<br />         var taxBracket = _taxBrackets[i];<br /><br />         if (incomeLeftToTax > taxBracket.LowerBound) {<br />            var taxableIncome = incomeLeftToTax - taxBracket.LowerBound;<br /><br />            incomeLeftToTax -= taxableIncome;<br />            effectiveTax += taxableIncome * taxBracket.TaxRate;<br />         }<br />      }<br /><br />      return effectiveTax;<br />   }<br /><br />   public void AddTaxBracket(Decimal lowerBound, Decimal taxRate) {<br />      _taxBrackets.Add(new TaxBracket {<br />         LowerBound = lowerBound,<br />         TaxRate = taxRate<br />      });<br />   }<br /><br />   private class TaxBracket {<br />      internal Decimal LowerBound { get; set; }<br />      internal Decimal TaxRate { get; set; }<br />   }<br />}<br /></taxbracket></taxbracket></pre><br />Finally we need to address a massive assumption with the current&nbsp;implementation. Mainly, that the tax brackets are in ascending order based on their lower bound. That is a pretty big assumption, and one that could lead to nasty bugs in the future.<br /><br />For our last test, we mix up the ordering of the tax brackets and make sure everything still works.<br /><br /><pre class="c-sharp" name="code">[TestMethod]<br />public void ShouldCorrectlyOrderTaxBrackets() {<br />   var effectiveTax = new EffectiveTax();<br />   effectiveTax.AddTaxBracket(lowerBound: 40230, taxRate: 0.45M);<br />   effectiveTax.AddTaxBracket(lowerBound: 14070, taxRate: 0.30M);<br />   effectiveTax.AddTaxBracket(lowerBound: 0, taxRate: 0.1M);<br />   effectiveTax.AddTaxBracket(lowerBound: 8660, taxRate: 0.23M);<br />   effectiveTax.AddTaxBracket(lowerBound: 21240, taxRate: 0.33M);<br />   effectiveTax.AddTaxBracket(lowerBound: 5070, taxRate: 0.14M);<br /><br />   Assert.AreEqual(0, effectiveTax.CalculateTaxes(0));<br />   Assert.AreEqual(500, effectiveTax.CalculateTaxes(5000));<br />   Assert.AreEqual(609.2M, effectiveTax.CalculateTaxes(5800));<br />   Assert.AreEqual(1087.8M, effectiveTax.CalculateTaxes(9000));<br />   Assert.AreEqual(2532.9M, effectiveTax.CalculateTaxes(15000));<br />   Assert.AreEqual(15068.1M, effectiveTax.CalculateTaxes(50000));<br />}<br /></pre><br />Clearly this fails miserably so with a little adjustment to our method, we can ensure the ordering is correct before we start processing. The added benefit is that the code is now even more expressive than the explicit for loop from the previous iteration.<br /><br /><pre class="c-sharp" name="code">public Decimal CalculateTaxes(Decimal grossIncome) {<br />   var effectiveTax = 0.0M;<br />   var incomeLeftToTax = grossIncome;<br /><br />   var orderedBrackets = _taxBrackets.OrderByDescending(tb => tb.LowerBound);<br /><br />   foreach (var taxBracket in orderedBrackets) {<br />      if (incomeLeftToTax > taxBracket.LowerBound) {<br />         var taxableIncome = incomeLeftToTax - taxBracket.LowerBound;<br /><br />         incomeLeftToTax -= taxableIncome;<br />         effectiveTax += taxableIncome * taxBracket.TaxRate;<br />      }<br />   }<br /><br />   return effectiveTax;<br />}<br /></pre><br />Now, there are some clear omissions here, like checking for negative values, but I think it accomplished the spirit of the question.<br /><br />As I stated previously I haven't read any of the other solutions, so this may be an exact duplicate. Also, there may be much more elegant solutions to this problem, but as usual TDD has lead to something that is neat, clean, and well tested :)<br /><br /><br /><br />
